<?php
	include_once  '../_init.php';
	include_once $GP -> INC_WWW . '/count_inc.php';
	include_once $GP -> INC_WWW . '/head.php';
    include_once($GP->CLS."class.naver.php");
    
	$url = $GP->NAVER_RETURN_URL."&re_url=".$_GET["re_url"];

	$naver = new Naver(array(
        "CLIENT_ID" => $GP->NAVER_CLIENT_ID,
        "CLIENT_SECRET" => $GP->NAVER_CLIENT_SECRET,
        "RETURN_URL" => $url,
        "AUTO_CLOSE" => true,
        "SHOW_LOGOUT" => false
        )
    );      
?>
<body>
	<div id="subCon6" class="wrap">
		<? include_once $GP -> INC_WWW . '/header.php'; ?>

		<section class="container wrapSubPageTop">
			<div class="boxSubPageTop">
				<? include_once $GP -> INC_WWW . '/location.php'; ?>
			</div>
			<div class="subVisual">
				<h4>로그인</h4>
				<p class="txt">
					<span>회원로그인 하시면</span>
					<strong>뉴고려병원 웹사이트의 <br />모든 서비스를 이용하실 수 있습니다.</strong>
				</p>
				<p class="type1"><img src="/images/content/img-login.jpg" alt=""></p>
			</div>
		</section>
		<section class="wrapBody">
			<div class="loginWrap">
				<form action="?" method="post" id="login-form" name="login-form">
					<input type="hidden" id="mode" name="mode" value="LOGIN" />
					<input type="hidden" id="re_rul" name="re_url" value="<?=$_GET['re_url']?>" />
					<fieldset>
						<legend>로그인</legend>
						<hr>
						<div class="login">
							<div class="inputBox">
								<label for="loginId">아이디</label>
								<input type="text" name="m_id" id="m_id" placeholder=" 아이디를 입력하세요" />
							</div>
							<div class="inputBox">
								<label for="loginPw">비밀번호</label>
								<input type="password" placeholder=" 패스워드를 입력하세요" name="m_pwd" id="m_pwd" />
							</div>
                            
							<a class="btnBox btBlue" href="javascript:;" id="img_login">로그인</a>
							<p class="chkId">
								<input type="checkbox" name="saveid" id="saveid" onClick="confirmSave()" />
								<label for="loginMaintenance">아이디 기억하기</label>
							</p>
						</div>
					</fieldset>
				</form>
				<div class="boxLoginBtns">
	                <?=$naver->login()?>
					<a href="javascript:;" class="btn_sns_login btnKakaoLogin" id="kakao_login">카카오 계정으로 로그인</a>
				</div>
				<ul class="loginHelp">
					<li>
						<p>아이디/비밀번호를 잊으셨나요?</p>
						<a href="javascript:;" id="id_find" class="btnBox btBlue">아이디/비밀번호 찾기</a>
					</li>
				</ul>
				<div class="boxLogin">
					<p>아직 뉴고려병원 회원이 아니세요?</p>
					<p>저희 뉴고려병원 웹사이트에서는 의료법령에 의거 일부 컨텐츠를 열람하실 때 꼭 로그인이 필요합니다. 또한 온라인 예약이나 상담 등은 개개인의 예약/상담 정보를 보관하여 상담 및 진료품질 향상에 사용합니다.</p>
					<p>보다 편리하고 원할한 이용을 위해 지금 회원에 가입해 보십시오.</p>
					<a class="btnBox btBlue" href="javascript:;" id="mem_register">회원가입<span>→</span></a>
				</div>
			</div>
		</section>

		<? include_once $GP -> INC_WWW . '/foot.php'; ?>
	</div>
	<script type="text/javascript" src="/js/jquery.validate.js"></script>
	<script type="text/javascript" src="/js/mem_login.js"></script>
<form name="r_form" id="r_form" method="post">
	<input type="hidden" name="re_url" id="mode" value="<?=$_GET["re_url"]?>">
	<input type="hidden" name="mode" id="mode" value="kakao">
	<input type="hidden" name="mb_id" id="r_id">
	<input type="hidden" name="mb_name" id="r_name">
</form>

<!-- //Content -->
</body>

<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
<script>
	$(document).ready(function(){
		Kakao.init("97634374c23a55427c514fb41590ad54");
		function getKakaotalkUserProfile(){
			Kakao.API.request({
				url: '/v1/user/me',
				success: function(res) {
					if(res.nickname) {
						$("#r_name").val(res.nickname);
					}
					$("#r_id").val(res.id);
					$("#r_form").attr("action","/mypage/proc/login_proc.php");
					$("#r_form").submit();
				},
				fail: function(error) {
					console.log(error);
				}
			});
		}
		//function createKakaotalkLogin(){
			$("#kakao_login").click(function(){
				Kakao.Auth.login({
					persistAccessToken: true,
					persistRefreshToken: true,					
					success: function(authObj) {
						getKakaotalkUserProfile();
					},
					fail: function(err) {
						//alert(err);
						console.log(err);
					}
				});
			});
			//$("#kakao-logged-group").prepend(loginBtn)
		//}
		if(Kakao.Auth.getRefreshToken()!=undefined&&Kakao.Auth.getRefreshToken().replace(/ /gi,"")!=""){
			//getKakaotalkUserProfile();
		}else{
			createKakaotalkLogin();
		}

	});
</script>
</html>